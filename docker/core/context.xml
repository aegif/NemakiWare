<?xml version="1.0" encoding="UTF-8"?>
<Context path="/core" docBase="core.war">
    <!-- Disable session persistence across Tomcat restarts -->
    <Manager pathname="" />
    
    <!-- Configure thread cleanup on context destruction -->
    <Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener" />
    <Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener" />
    
    <!-- Set this to true to force Tomcat to stop threads on context unload -->
    <JarScanner scanManifest="false">
        <JarScanFilter defaultPluggabilityScan="false" defaultTldScan="false" />
    </JarScanner>
    
    <!-- Add custom system properties to disable Ektorp idle connection monitor -->
    <Environment name="org.ektorp.support.AutoUpdateViewOnChange" value="false" type="java.lang.Boolean" />
    <Environment name="org.ektorp.http.IdleConnectionMonitor.enabled" value="false" type="java.lang.Boolean" />
    <Environment name="org.ektorp.support.DesignDocument.UPDATE_ON_DIFF" value="false" type="java.lang.Boolean" />
    <Environment name="org.ektorp.support.DesignDocument.ALLOW_AUTO_UPDATE" value="false" type="java.lang.Boolean" />
    <Environment name="org.apache.catalina.loader.WebappClassLoader.ENABLE_CLEAR_REFERENCES" value="true" type="java.lang.Boolean" />
    
    <!-- Disable thread creation for Ektorp -->
    <Loader className="org.apache.catalina.loader.WebappLoader" delegate="true" />
    <Resources cachingAllowed="false" />
    
    <!-- Set context parameters to disable Ektorp thread creation -->
    <Parameter name="org.ektorp.support.AutoUpdateViewOnChange" value="false" override="false" />
    <Parameter name="org.ektorp.http.IdleConnectionMonitor.enabled" value="false" override="false" />
    <Parameter name="org.ektorp.support.DesignDocument.UPDATE_ON_DIFF" value="false" override="false" />
    <Parameter name="org.ektorp.support.DesignDocument.ALLOW_AUTO_UPDATE" value="false" override="false" />
</Context>
