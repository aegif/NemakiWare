import{R as I}from"./index-BXMmouFQ.js";import{C as x}from"./custom-media-element-Ce0vsE-t.js";import{M as A,H as m}from"./hls-CZhmVaL9.js";const H=e=>class extends e{static shadowRootOptions={...e.shadowRootOptions};static getTemplateHTML=(t,n={})=>{const{src:h,...E}=t;return`
        <script type="application/json" id="config">
          ${JSON.stringify(n.config||{})}
        <\/script>
        ${e.getTemplateHTML(E)}
      `};#t=null;#e=null;constructor(){super(),this.#s("config")}get config(){return this.#e}set config(t){this.#e=t}attributeChangedCallback(t,n,h){t!=="src"&&super.attributeChangedCallback(t,n,h),t==="src"&&n!=h&&this.load()}#n(){var t,n;(t=this.#t)==null||t.remove(),(n=this.nativeEl)==null||n.removeEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.#i),this.api&&(this.api.detachMedia(),this.api.destroy(),this.api=null)}async load(){var t,n;const h=!this.api;if(this.#n(),!!this.src){if(h&&!this.#e&&(this.#e=JSON.parse(((t=this.shadowRoot.getElementById("config"))==null?void 0:t.textContent)||"{}")),m.isSupported()){switch(this.api=new m({liveDurationInfinity:!0,autoStartLoad:!1,...this.config}),await Promise.resolve(),this.api.loadSource(this.src),this.api.attachMedia(this.nativeEl),this.nativeEl.preload){case"none":{const a=()=>this.api.startLoad();this.nativeEl.addEventListener("play",a,{once:!0}),this.api.on(m.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",a)});break}case"metadata":{const a=this.api.config.maxBufferLength,l=this.api.config.maxBufferSize;this.api.config.maxBufferLength=1,this.api.config.maxBufferSize=1;const c=()=>{this.api.config.maxBufferLength=a,this.api.config.maxBufferSize=l};this.nativeEl.addEventListener("play",c,{once:!0}),this.api.on(m.Events.DESTROYING,()=>{this.nativeEl.removeEventListener("play",c)}),this.api.startLoad();break}default:this.api.startLoad()}this.nativeEl.webkitCurrentPlaybackTargetIsWireless&&this.api.stopLoad(),this.nativeEl.addEventListener("webkitcurrentplaybacktargetiswirelesschanged",this.#i),this.#t=document.createElement("source"),this.#t.setAttribute("type","application/x-mpegURL"),this.#t.setAttribute("src",this.src),this.nativeEl.disableRemotePlayback=!1,this.nativeEl.append(this.#t);const E=new WeakMap;this.api.on(m.Events.MANIFEST_PARSED,(a,l)=>{this.nativeEl.autoplay&&this.nativeEl.paused&&this.nativeEl.play().catch(r=>{console.warn("Autoplay failed:",r)}),y();let c=this.videoTracks.getTrackById("main");c||(c=this.addVideoTrack("main"),c.id="main",c.selected=!0);for(const[r,o]of l.levels.entries()){const T=c.addRendition(o.url[0],o.width,o.height,o.videoCodec,o.bitrate);E.set(o,`${r}`),T.id=`${r}`}for(let[r,o]of l.audioTracks.entries()){const T=o.default?"main":"alternative",u=this.addAudioTrack(T,o.name,o.lang);u.id=`${r}`,o.default&&(u.enabled=!0)}}),this.audioTracks.addEventListener("change",()=>{var a;const l=+((a=[...this.audioTracks].find(r=>r.enabled))==null?void 0:a.id),c=this.api.audioTracks.map(r=>r.id);l!=this.api.audioTrack&&c.includes(l)&&(this.api.audioTrack=l)}),this.api.on(m.Events.LEVELS_UPDATED,(a,l)=>{const c=this.videoTracks[this.videoTracks.selectedIndex??0];if(!c)return;const r=l.levels.map(o=>E.get(o));for(const o of this.videoRenditions)o.id&&!r.includes(o.id)&&c.removeRendition(o)});const k=a=>{const l=a.target.selectedIndex;l!=this.api.nextLevel&&(this.api.nextLevel=l)};(n=this.videoRenditions)==null||n.addEventListener("change",k);const y=()=>{for(const a of this.videoTracks)this.removeVideoTrack(a);for(const a of this.audioTracks)this.removeAudioTrack(a)};this.api.once(m.Events.DESTROYING,y);return}await Promise.resolve(),this.nativeEl.canPlayType("application/vnd.apple.mpegurl")&&(this.nativeEl.src=this.src)}}#i=()=>{var t,n,h;(t=this.nativeEl)!=null&&t.webkitCurrentPlaybackTargetIsWireless?(n=this.api)==null||n.stopLoad():(h=this.api)==null||h.startLoad()};#s(t){if(Object.prototype.hasOwnProperty.call(this,t)){const n=this[t];delete this[t],this[t]=n}}},R=H(A(x));globalThis.customElements&&!globalThis.customElements.get("hls-video")&&globalThis.customElements.define("hls-video",R);var O=R,N=new Set(["style","children","ref","key","suppressContentEditableWarning","suppressHydrationWarning","dangerouslySetInnerHTML"]),C={className:"class",htmlFor:"for"};function P(e){return e.toLowerCase()}function S(e){if(typeof e=="boolean")return e?"":void 0;if(typeof e!="function"&&!(typeof e=="object"&&e!==null))return e}function B({react:e,tagName:g,elementClass:t,events:n,displayName:h,defaultProps:E,toAttributeName:k=P,toAttributeValue:y=S}){const a=Number.parseInt(e.version)>=19,l=e.forwardRef((c,r)=>{var o,T;const u=e.useRef(null),L=e.useRef(new Map),w={},_={},v={},b={};for(const[i,s]of Object.entries(c)){if(N.has(i)){v[i]=s;continue}const d=k(C[i]??i);if(i in t.prototype&&!(i in(((o=globalThis.HTMLElement)==null?void 0:o.prototype)??{}))&&!((T=t.observedAttributes)!=null&&T.some(p=>p===d))){b[i]=s;continue}if(i.startsWith("on")){w[i]=s;continue}const f=y(s);if(d&&f!=null&&(_[d]=String(f),a||(v[d]=f)),d&&a){const p=S(s);f!==p?v[d]=f:v[d]=s}}if(typeof window<"u"){for(const i in w){const s=w[i],d=i.endsWith("Capture"),f=(n?.[i]??i.slice(2).toLowerCase()).slice(0,d?-7:void 0);e.useLayoutEffect(()=>{const p=u?.current;if(!(!p||typeof s!="function"))return p.addEventListener(f,s,d),()=>{p.removeEventListener(f,s,d)}},[u?.current,s])}e.useLayoutEffect(()=>{if(u.current===null)return;const i=new Map;for(const s in b)M(u.current,s,b[s]),L.current.delete(s),i.set(s,b[s]);for(const[s,d]of L.current)M(u.current,s,void 0);L.current=i})}if(typeof window>"u"&&t?.getTemplateHTML&&t?.shadowRootOptions){const{mode:i,delegatesFocus:s}=t.shadowRootOptions,d=e.createElement("template",{shadowrootmode:i,shadowrootdelegatesfocus:s,dangerouslySetInnerHTML:{__html:t.getTemplateHTML(_,c)}});v.children=[d,v.children]}return e.createElement(g,{...E,...v,ref:e.useCallback(i=>{u.current=i,typeof r=="function"?r(i):r!==null&&(r.current=i)},[r])})});return l.displayName=h??t.name,l}function M(e,g,t){var n;e[g]=t,t==null&&g in(((n=globalThis.HTMLElement)==null?void 0:n.prototype)??{})&&e.removeAttribute(g)}var j=B({react:I,tagName:"hls-video",elementClass:O,toAttributeName(e){return e==="muted"?"":e==="defaultMuted"?"muted":P(e)}});export{j as default};
