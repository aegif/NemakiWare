# フォルダ階層とスコープ検索のテスト

## テスト概要

このテストスイートは、フォルダ階層の作成、ドキュメントの配置、スコープ付き検索（IN_TREE/IN_FOLDER）、およびドキュメント移動後の検索動作を検証します。

## テスト目的

- フォルダ階層の作成と管理を確認
- 異なるフォルダへのドキュメント配置を検証
- IN_TREE/IN_FOLDER検索述語の動作を確認
- ドキュメント移動後の検索結果の変化を検証

## 前提条件

- NemakiWareサーバーが http://localhost:8080/core/ui/ で稼働していること
- admin:admin でログイン可能であること
- フォルダ管理機能がUIで利用可能であること

## テストステップ詳細

### Step 1: ルートフォルダの作成

**操作内容**:
1. ドキュメント一覧画面に遷移
2. 「新規フォルダ」ボタンをクリック
3. フォルダ名（例: `test:rootFolder{uuid}`）を入力
4. 作成ボタンをクリック

**期待結果**:
- ルートフォルダが正常に作成される
- ドキュメント一覧テーブルに表示される

**検証するCMIS概念**:
- createFolder operation
- Folder hierarchy root

---

### Step 2: サブフォルダの作成

**操作内容**:
1. ルートフォルダに移動
2. 「新規フォルダ」ボタンをクリック
3. サブフォルダA（例: `test:subFolderA{uuid}`）を作成
4. 同様にサブフォルダB（例: `test:subFolderB{uuid}`）を作成

**期待結果**:
- サブフォルダAとBが正常に作成される
- ルートフォルダ内に表示される
- 階層構造が正しく形成される

**検証するCMIS概念**:
- Nested folder creation
- Parent-child relationships

---

### Step 3: 異なるサブフォルダにドキュメントを作成

**操作内容**:
1. サブフォルダAに移動
2. テストドキュメントA（例: `test:docInFolderA{uuid}.txt`）をアップロード
3. サブフォルダBに移動
4. テストドキュメントB（例: `test:docInFolderB{uuid}.txt`）をアップロード

**期待結果**:
- 各ドキュメントが対応するフォルダに作成される
- フォルダ内に正しく表示される

**検証するCMIS概念**:
- createDocument in specific folder
- Document filing

---

### Step 4: フォルダスコープ検索（IN_TREE）

**操作内容**:
1. 検索画面に遷移
2. 検索テキストにドキュメント名の一部を入力
3. フォルダスコープとしてルートフォルダを選択（利用可能な場合）
4. 検索ボタンをクリック

**期待結果**:
- ルートフォルダ配下の両方のドキュメントが検索結果に表示される
- IN_TREE述語が正しく機能する

**検証するCMIS概念**:
- CMIS SQL Query with IN_TREE predicate
- Recursive folder search

---

### Step 5: ドキュメントを別フォルダに移動

**操作内容**:
1. サブフォルダAに移動
2. テストドキュメントAを選択
3. 移動操作を実行（コンテキストメニューまたはドラッグ&ドロップ）
4. 移動先としてサブフォルダBを選択
5. 移動を確認

**期待結果**:
- ドキュメントがサブフォルダAからサブフォルダBに移動される
- サブフォルダAにはドキュメントが表示されない
- サブフォルダBに両方のドキュメントが表示される

**検証するCMIS概念**:
- moveObject operation
- Parent folder update

---

### Step 6: 移動後の検索結果を確認

**操作内容**:
1. 検索画面に遷移
2. サブフォルダAをスコープとして検索
3. サブフォルダBをスコープとして検索

**期待結果**:
- サブフォルダAスコープでは移動したドキュメントがヒットしない
- サブフォルダBスコープでは両方のドキュメントがヒットする
- 検索インデックスが移動を反映している

**検証するCMIS概念**:
- Search index update after move
- IN_FOLDER predicate accuracy

## フォルダ階層の概念

### CMIS フォルダモデル
CMISでは、フォルダは他のフォルダやドキュメントを含むことができるコンテナオブジェクトです。

### 検索述語
- **IN_FOLDER**: 指定フォルダの直接の子のみを検索
- **IN_TREE**: 指定フォルダ配下のすべての子孫を再帰的に検索

### マルチファイリング
CMISはマルチファイリング（1つのドキュメントを複数のフォルダに配置）をサポートしますが、NemakiWareの実装状況を確認してください。

## トラブルシューティング

### フォルダ作成が失敗する場合
- 親フォルダへの書き込み権限があるか確認
- フォルダ名に使用できない文字が含まれていないか確認

### 移動操作が失敗する場合
- 移動先フォルダへの書き込み権限があるか確認
- ドキュメントがチェックアウト中でないか確認

### 検索結果が期待と異なる場合
- Solrのインデックス更新に時間がかかる場合がある
- フォルダスコープが正しく設定されているか確認
