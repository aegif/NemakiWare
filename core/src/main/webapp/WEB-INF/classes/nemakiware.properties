###Database
db.couchdb.url=http://localhost:5984
db.couchdb.max.connections=20
db.couchdb.connection.timeout=30000
db.couchdb.socket.timeout=60000
db.couchdb.auth.enabled=true
db.couchdb.auth.username=admin
db.couchdb.auth.password=password

###CMIS server default parameter
cmis.server.default.max.items.types=50
cmis.server.default.depth.types=-1
cmis.server.default.max.items.objects=200
cmis.server.default.depth.objects=10
# Default repository for service document requests (e.g., /atom without repository ID)
# Required for cmislib and similar CMIS clients that access /atom without specifying repository
# If not specified, uses the first repository defined in repositories.yml
cmis.server.default.repository=bedroom

###Repository
repository.definition.default=repositories-default.yml
repository.definition=repositories.yml

###Search engine
solr.protocol=http
solr.host=solr
solr.port=8983
solr.context=solr
solr.indexing.force=true
solr.nemaki.userid=solr

###Permission
permission.definition=permission.yml
permission.mapping.definition=permission-mapping.yml

###Spring configuration
context.log=logContext.xml
context.businesslogic=businesslogicContext.xml
context.dao=daoContext.xml
context.dao.implementation=couchContext.xml

###NemakiWare extended capability
capability.extended.orderBy.default=cmis:creationDate DESC
capability.extended.preview=false
capability.extended.include.relationships=true
capability.extended.unique.name.check=true
capability.extended.auth.token=true
capability.extended.permission.toplevel=false
capability.extended.permission.inheritance.toplevel=true
capability.extended.user.item.folder=e02f784f8360a02cc14d1314c10038ff

###Rest API
rest.user.enabled=true
rest.group.enabled=true
rest.type.enabled=true
rest.archive.enabled=true
rest.authtoken.enabled=true

###Archive Configuration
# Enable archive creation for deleted content restoration
# When enabled, deleted content is archived to the archive repository (e.g., bedroom_closet)
archive.create.enabled=true

###Deletion Configuration
# Enable deletion verification after CouchDB delete operations
# When enabled, each deletion is verified with ~50ms overhead per object
# Disabling improves deletion performance but may miss failed deletions
deletion.verify.enabled=true

###Rendition
jodconverter.registry.dataformats=rendition-format.yml
# Path to LibreOffice/OpenOffice installation (required for PDF conversion)
#jodconverter.officehome=/opt/libreoffice
# Port for LibreOffice headless process (default: 8100)
jodconverter.port=8100

###Logging
log.aspect.class=jp.aegif.nemaki.util.spring.aspect.log.JsonLogger
log.aspect.expression=execution(* jp.aegif.nemaki.cmis.service..*Impl.*(..)) and !execution(* jp.aegif.nemaki.cmis.service.impl.RepositoryServiceImpl.*(..))
log.config.json.file=log-json-config.json

###Audit Logging
# Enable/disable audit logging (default: false - requires explicit enablement for safety)
audit.enabled=true
# READ operation audit level (WRITE/DELETE/ACL changes are ALWAYS logged)
#   NONE     - No READ operations logged (default - low overhead)
#   DOWNLOAD - Content downloads only (getContentStream, getRenditions) - highest risk
#   METADATA - + Object/property reads (getObject, getObjectByPath, getAcl)
#   ALL      - + Navigation (getChildren, getFolderTree, query) - high volume
audit.read.level=DOWNLOAD
# Deprecated: use audit.read.level instead (if both set, audit.read.level takes precedence)
# audit.log.read.operations=false
# Detail level: MINIMAL, STANDARD, VERBOSE (default: STANDARD)
audit.detail.level=STANDARD
# Comma-separated list of user IDs to exclude from audit logging
audit.exclude.users=solr
# Comma-separated list of operation names to exclude from audit logging
audit.exclude.operations=
# Log failures at WARN level instead of INFO (default: true)
audit.log.failures.as.warn=true
# Maximum length for request path in audit logs (default: 2000)
# Longer paths are truncated to prevent log flooding
#audit.request.path.max.length=2000
# Async queue size is configured in logback.xml (default: 512)
# See: AUDIT_ASYNC appender queueSize setting
#audit.async.queue.size=512

###Cache
cache.config=ehcache.yml

###Auth token
auth.token.expiration=86400000

###Thread
thread.max=200

###proxyHeadear
external.authenticaion.proxyHeader=X-NemakiWare-Remote-User
external.authenticaion.isAutoCreateUser=false

###CMIS Base Type Configuration Override (for full CMIS 1.1 compliance)
basetype.document.contentStreamAllowed=allowed
# Enable versioning for full CMIS 1.1 compliance
# Documents will support check-in, check-out, and version history
basetype.document.versionable=true

# Policy type should be creatable and queryable for CMIS compliance
basetype.policy.creatable=true
basetype.policy.queryable=true

# Item type should be queryable for CMIS 1.1 compliance
basetype.item.queryable=true

###CMIS Versioning Configuration Override (for TCK compliance)
# Ensure version deletion capability is explicitly enabled
capability.versioning.delete=true

# Ensure Private Working Copy (PWC) capability is enabled
capability.versioning.pwc=true

# Ensure all versioning states are supported
capability.versioning.state.none=true
capability.versioning.state.minor=true  
capability.versioning.state.major=true

###CMIS CRUD Capabilities Configuration Override (for TCK compliance)
# Ensure copy/move operations are supported
capability.object.copy=true
capability.object.move=true

# Ensure change token support (optional but may be tested)
capability.change.token=true

# Ensure bulk update operations are supported
capability.object.bulk.update=true

# Ensure content stream updates are supported
capability.content.stream.updates=anytime

# Ensure join operations are supported for query
capability.query.joins=none

###CMIS Query Configuration Override (for TCK compliance)
# Ensure query capability is fully enabled
capability.query=both

# Ensure full-text search is supported
capability.query.fulltext=true

# Ensure query can return all properties
capability.query.all.properties=true

# Ensure query supports basic operators
capability.query.operators=like,in,equals,comparison

# Enable query paging
capability.query.paging=true

###CMIS Filing Configuration Override (for TCK compliance)
# Disable multi-filing and unfiling as per requirements
# "マルチファイリングとアンファイリング意外はすべてNemakiwareに備わっているはずの機能"
capability.multifiling=false
capability.unfiling=false

# Ensure basic filing operations are supported
capability.filing=true

###Directory Sync Configuration
# Enable directory sync feature
directory.sync.enabled=false

# LDAP connection settings
directory.sync.ldap.url=ldap://localhost:389
directory.sync.ldap.base.dn=dc=example,dc=com
directory.sync.ldap.bind.dn=cn=admin,dc=example,dc=com
# Password can be specified in three formats:
# 1. Plain text (not recommended for production): mypassword
# 2. Encrypted with ENC() prefix: ENC(base64encodeddata)
#    Use PasswordEncryptionUtil to encrypt passwords
# 3. Environment variable reference: ENV(LDAP_BIND_PASSWORD)
directory.sync.ldap.bind.password=
directory.sync.ldap.use.tls=false
directory.sync.ldap.use.starttls=false
directory.sync.ldap.connection.timeout=5000
directory.sync.ldap.read.timeout=30000

# Search settings
directory.sync.group.search.base=ou=groups
directory.sync.group.search.filter=(objectClass=groupOfNames)
directory.sync.user.search.base=ou=users
directory.sync.user.search.filter=(objectClass=inetOrgPerson)

# Attribute mapping
directory.sync.group.id.attribute=cn
directory.sync.group.name.attribute=description
directory.sync.group.member.attribute=member
directory.sync.user.id.attribute=uid

# Sync options
directory.sync.nested.groups=true
directory.sync.create.missing.users=true
directory.sync.update.existing.users=true
directory.sync.delete.orphan.groups=true
# IMPORTANT: delete.orphan.users only works when user.prefix is NOT empty.
# This is a safety measure to prevent accidental deletion of non-LDAP users.
# To enable orphan user deletion, you MUST set a non-empty user.prefix.
directory.sync.delete.orphan.users=false
directory.sync.group.prefix=ldap_
directory.sync.user.prefix=

# Schedule settings
# Enable scheduled synchronization
directory.sync.schedule.enabled=false
# Cron expression for sync schedule (Spring cron format: second minute hour day month weekday)
# Example: "0 0 2 * * *" = every day at 2:00 AM
directory.sync.schedule.cron=0 0 2 * * *
# Node IP for cluster environments (optional)
# If set, only the node with this IP will execute scheduled syncs.
# Leave empty for single-node deployments or to allow all nodes to sync.
directory.sync.schedule.node.ip=
