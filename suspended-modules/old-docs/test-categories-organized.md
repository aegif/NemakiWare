# NemakiWare テスト分類・整理

## テスト項目の目的別分類

### 1. 基本機能テスト（Basic Functionality Tests）

**目的**: システムの基本的な動作を確認する必須テスト

#### 1.1 コンテナ・環境テスト
- ✅ **Java 17環境確認**: `java -version`
- ✅ **Dockerコンテナ状態確認**: `docker ps`
- ✅ **CouchDBデータベース確認**: `curl -u admin:password http://localhost:5984/_all_dbs`

#### 1.2 CMIS基本API
- ✅ **CMISリポジトリ情報**: `curl -u admin:admin http://localhost:8080/core/atom/bedroom`
- ✅ **CMISブラウザバインディング**: repositoryInfo、children取得
- ✅ **CMISルートフォルダアクセス**: ルートフォルダの正常取得

#### 1.3 REST API基本
- ✅ **リポジトリ一覧**: `curl -u admin:admin http://localhost:8080/core/rest/all/repositories`
- ✅ **RESTテストエンドポイント**: システム稼働状況確認

**実行方法**: `./qa-test.sh`（基本9項目）

---

### 2. CMIS 1.1標準準拠テスト（CMIS Compliance Tests）

**目的**: CMIS 1.1仕様への準拠性を検証

#### 2.1 CMIS AtomPub Binding
- ✅ **AtomPub仕様準拠**: XML形式、HTTP動詞の正しい使用
- ✅ **CMIS Query**: SQL形式クエリの実行と結果取得
- ✅ **Type Definition**: 型定義システムの動作確認

#### 2.2 CMIS Browser Binding  
- ✅ **JSON形式API**: Browser Bindingによるオブジェクト操作
- ✅ **cmisselector**: repositoryInfo、children、objectなどの選択子

#### 2.3 CMIS データ型・プロパティ
- ✅ **必須プロパティ**: cmis:objectId、cmis:name、cmis:baseTypeId
- ✅ **型システム**: cmis:document、cmis:folder基本型の動作

**実行方法**: `./qa-test.sh`（CMIS仕様部分）

---

### 3. UI機能テスト（User Interface Tests）  

**目的**: React SPA UIの動作とCMISバックエンドとの統合を検証

#### 3.1 UI基本アクセス
- ✅ **React UIアクセス**: `http://localhost:8080/core/ui/dist/` (HTTP 200)
- ✅ **静的ファイル配信**: JavaScript、CSSバンドルの正常配信
- ✅ **UI初期読み込み時間**: 2秒以内（パフォーマンス基準）

#### 3.2 認証システム統合
- ✅ **リポジトリ一覧取得**: UI用認証エンドポイント
- ✅ **CMIS認証**: admin:adminによる基本認証

#### 3.3 実際のCRUD操作
- ✅ **CREATE**: フォルダ作成、ドキュメント作成（AtomPub）
- ✅ **READ**: オブジェクト取得、プロパティ確認
- ⚠️ **UPDATE**: プロパティ更新（change token要対応）
- ✅ **DELETE**: オブジェクト削除

#### 3.4 UI固有機能
- ✅ **Sitesフォルダ**: パッチシステムによる自動作成フォルダ
- ✅ **基本検索機能**: CMIS Query経由の検索
- ✅ **フォルダ子要素一覧**: ページング対応

**実行方法**: `./test-ui-crud-atompub.sh`（16項目、成功率94%）

---

### 4. パフォーマンステスト（Performance Tests）

**目的**: システムの応答性能とスケーラビリティを測定

#### 4.1 応答時間測定
- ✅ **UI初期読み込み**: 23ms（基準: <2000ms）
- ✅ **CMIS Query応答**: 265ms（基準: <5000ms）
- ✅ **CRUD操作応答**: フォルダ作成、ドキュメント作成の応答時間

#### 4.2 同時接続・負荷テスト
- ⏳ **同時ユーザー**: 複数ユーザーでの同時アクセステスト（未実装）
- ⏳ **大量データ処理**: 1000件以上のドキュメント処理（未実装）

#### 4.3 メモリ・リソース使用量
- ⏳ **コンテナメモリ使用量**: 長時間稼働でのメモリリーク確認（未実装）
- ⏳ **CouchDBディスク使用量**: 大量データ保存時のディスク効率（未実装）

**実行方法**: `./test-ui-crud-atompub.sh`（パフォーマンス部分）

---

### 5. 統合テスト（Integration Tests）

**目的**: 複数システム間の連携動作を確認

#### 5.1 検索エンジン統合
- ✅ **Solr検索エンジンURL**: `curl http://localhost:8983/solr/nemaki/select`
- ✅ **Solr初期化エンドポイント**: インデックス作成確認

#### 5.2 データベース統合  
- ✅ **CouchDBビュー**: design documentの正常動作
- ✅ **パッチシステム**: データベース初期化とマイグレーション

#### 5.3 コンテナ間通信
- ✅ **core↔solr**: 検索機能の連携
- ✅ **core↔couchdb**: データ永続化の連携

**実行方法**: `./qa-test.sh`（統合部分）

---

### 6. セキュリティテスト（Security Tests）

**目的**: 認証・認可・データ保護機能の確認

#### 6.1 認証テスト
- ✅ **基本認証**: admin:adminによる認証成功
- ⏳ **不正認証拒否**: 無効な認証情報での拒否確認（未実装）
- ⏳ **セッション管理**: 認証トークンの適切な管理（未実装）

#### 6.2 認可テスト  
- ✅ **ACL機能**: Access Control Listの動作確認
- ⏳ **権限制御**: ユーザー別権限の適切な制御（未実装）

#### 6.3 データ保護
- ⏳ **SQLインジェクション対策**: CMIS Query安全性（未実装）
- ⏳ **XSS対策**: UI入力値の適切なエスケープ（未実装）

**実行方法**: 専用セキュリティテストスクリプト（要作成）

---

## テスト実行戦略

### クイックテスト（開発中）
```bash
./qa-test.sh  # 基本機能 + CMIS準拠（約30秒）
```

### 包括的テスト（リリース前）
```bash
./qa-test.sh                    # 基本機能・CMIS準拠
./test-ui-crud-atompub.sh      # UI機能・CRUD操作
./test-ui-comprehensive.sh     # UI詳細機能（既存）
```

### 継続的インテグレーション
- **毎コミット**: クイックテスト（基本機能）
- **毎日**: 包括的テスト（全カテゴリ）  
- **リリース前**: 手動UIテスト + 負荷テスト

---

## テスト成熟度レベル

| カテゴリ | 実装度 | 成功率 | 推奨アクション |
|---------|--------|--------|----------------|
| **基本機能** | 100% | 100% | ✅ 維持・継続実行 |
| **CMIS準拠** | 90% | 100% | ✅ 維持・継続実行 |
| **UI機能** | 95% | 94% | ✅ change token対応 |
| **パフォーマンス** | 30% | 100% | 🔶 負荷テスト追加 |
| **統合** | 80% | 100% | ✅ 維持・継続実行 |
| **セキュリティ** | 20% | - | 🔴 優先的に実装 |

---

## 次のステップ推奨事項

### 短期（1-2週間）
1. **change token対応**: UI更新操作の完全動作
2. **セキュリティテスト基盤**: 認証・認可テストの基本実装

### 中期（1-2ヶ月）  
3. **負荷テスト**: 同時接続・大量データテスト
4. **自動化CI**: GitHubアクション等での自動テスト実行

### 長期（3-6ヶ月）
5. **エンドツーエンド自動化**: Seleniumでのブラウザ自動テスト
6. **監視・メトリクス**: 本番環境でのパフォーマンス監視